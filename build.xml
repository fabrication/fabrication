<?xml version="1.0"?>
<project name="Fabrication" default="main">
	
	<!-- load user properties -->
	<property file="user.properties" />
	
	<!-- load standard build properties -->
	<property file="build.properties" />
	
	<!-- import fabrication build file -->
	<import file="${fabrication.build.dir}/common.xml" />

	<target name="clean" description="Removes all build generated files">
		<delete dir="${build.dir}" />
		<mkdir dir="${build.dir}" />
	</target>
	
	<target name="build" description="Compiles the fabrication swc">
		<flex-comp output="${fabrication.swc}">
			<fileset dir="${src.main.flash}">
				<include name="**/*.mxml" />
				<include name="**/*.as" />
			</fileset>
		</flex-comp>
	</target>
	
	<target name="run" />
	
	<target name="asdoc" description="Generates asdocs">
		<asdoc 
			window-title="${asdoc.window-title}" 
			destdir="${doc.asdoc}">
			<fileset dir="${src.main.flash}">
				<include name="**/*.as" />
				<include name="**/*.mxml" />
			</fileset>
		</asdoc>
	</target>
	
	<target name="publish-asdoc" description="Publishes asdocs to the svn">
		<svn username="${svn.username}" password="${svn.password}">
			<revert dir="${doc.asdoc}" recurse="yes" />
			<delete dir="${doc.asdoc}" />
			<commit dir="${doc.asdoc}" message="Removed old asdocs."/>
		</svn>
		<delete dir="${doc.asdoc}" failonerror="no" />
		<antcall target="asdoc" />
		<svn username="${svn.username}" password="${svn.password}">
			<add dir="${doc.asdoc}" recurse="yes" />
		</svn>
		<set-mimetypes>
			<fileset dir="${doc.asdoc}">
				<include name="**/*.*" />
			</fileset>
		</set-mimetypes>
		<svn username="${svn.username}" password="${svn.password}">
			<commit dir="${doc.asdoc}" message="Added updated asdocs." />
		</svn>
	</target>
	
	<target name="zip" description="Generates a zip file from the trunk">
		<delete file="${fabrication.source.zip}" failonerror="no"/>
		<zip destfile="${fabrication.source.zip}">
			<fileset dir="${basedir}">
				<exclude name="user.properties" />
				<exclude name=".settings/**" />
				<exclude name=".*" />
				<exclude name="bin/*.swc" />
				<exclude name="**/*.zip" />
				<include name="**/*.*" />
				<include name="COPYING" />
			</fileset>
			<fileset dir="${basedir}">
				<include name="bin/fabrication-${fabrication.version}.swc"/>
			</fileset>
		</zip>
	</target>
	
	<target name="publish-to-googlecode" description="Publishes the current zource to the google code downloads">
		<echo>Uploading ${fabrication.version} swc</echo>
		<property name="fabrication.swc.file" location="${bin}/fabrication-${fabrication.version}.swc" />
		<property name="fabrication.src.file" location="${bin}/fabrication-trunk-src.zip" />
		
		<gcupload 
			username="${svn.username}"
			password="${svn.password}"
			projectname="fabrication"
			filename="${fabrication.swc.file}"
			targetfilename="fabrication-${fabrication.version}.swc"
			summary="Fabrication ${fabrication.version} swc"
			labels="Featured, Type-Package, OpSys-All"
		/>

		<echo>Uploading ${fabrication.version} source zip</echo>
		<gcupload 
			username="${svn.username}"
			password="${svn.password}"
			projectname="fabrication"
			filename="${fabrication.src.file}"
			targetfilename="fabrication-${fabrication.version}-src.zip"
			summary="Fabrication ${fabrication.version} Source Zip"
			labels="Featured, Type-Package, OpSys-All"
		/>
	</target>
	
	<target name="all" depends="clean, build, asdoc" 
		description="Removes previous compiled files and rebuilds the main application and generates asdocs">
	</target>
	
	<target name="main" depends="build" 
		description="Default target, build">
	</target>
	
</project>